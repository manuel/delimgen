<html><head><script type="module">
async function main() {
  /*
   * Spawn some pre-existing balls.
   */
  ball(100, 200);
  ball(200, 300);
  ball(300, 400);
  /*
   * Main loop.
   *
   * Block on click events, spawn a new ball on each click.
   */
  while (true) {
    const event = await new Promise((resolve) =>
      document.addEventListener("click", resolve, { once: true }),
    );
    ball(event.pageX, event.pageY);
  }
}

window.onload = () => main();

const sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));

async function ball(x, y) {
  const ball = document.createElement("div");
  ball.classList.add("ball");
  ball.style.left = x + "px";
  ball.style.top = y + "px";
  document.body.appendChild(ball);
  const xdelta = -5 + rand(0, 10);
  const ydelta = -5 + rand(0, 10);
  while (true) {
    x += xdelta;
    y += ydelta;
    ball.style.left = x + "px";
    ball.style.top = y + "px";
    await sleep(50);
  }
}

function rand(min, max) {
  return Math.random() * (max - min) + min;
}


</script>
<style>.ball { position: absolute; width: 50px; height: 50px; background-color: red; border-radius: 50px; }</style>
</head>
<body><b>Click anywhere to spawn new generators.  View source to see how it works.</b></body>
</html>
